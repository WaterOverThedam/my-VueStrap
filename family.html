<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>家庭</title>
    <link rel="shortcut icon" href="https://static.thelittlegym.com.cn/assert/img/logo.ico"> 
    <link rel="stylesheet" href="https://static.thelittlegym.com.cn/assert/ui/semantic/semantic.min.css">
    <link rel="stylesheet" href="https://static.thelittlegym.com.cn/assert/ui/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="https://bbk.800app.com/uploadfile/staticresource/238592/279833/tlgc.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!--[if lt IE 9]>
      <link rel="stylesheet" href="incompatible.css">
    <![endif]-->
    <script src="https://bbk.800app.com/uploadfile/staticresource/238592/279833/jquery-1.11.3.min.js"></script>
    <script src="https://bbk.800app.com/uploadfile/staticresource/238592/279833/gym.js"></script>
    <script src="https://bbk.800app.com/uploadfile/staticresource/238592/279833/vue.js"></script>
    <script src="https://bbk.800app.com/uploadfile/staticresource/238592/279833/axios.min.js"></script>


    <script>
        var url_jsonp = "https://bbk.800app.com/uploadfile/staticresource/238592/279833/dataInterface_jsonp_uni.aspx";
        var url_local = "https://bbk.800app.com//uploadfile/staticresource/238592/279833/api_auto_json.aspx";
        var sql_getGym = "select crm_name name,gym.crmzdy_80620116 code,id,cast(id as varchar)add;'|'add;cast(isnull(crmzdy_81768666,0) as varchar)  gym from crm_zdytable_238592_23594_238592_view gym join (select top 1 crm_jiandang,crmzdy_81611236 gymlist from crm_yh_238592_view where id=iduser)yh on gym.crmzdy_80620116 >'500004' and gym.crmzdy_82037329=1 and (yh.crm_jiandang in ('@consultant','@administrator','市场顾问','市场专员') or (yh.crm_jiandang in ('中心运营总监','中心运营总监(练习)','中心员工','课程主管','销售主管','中心员工(练习)') and charindex(gym.crm_name,yh.gymlist)>0)) order by name";
        var sql_quanxian ="selectnbsp;crmzdy_81611236nbsp;gyms,crm_jiandangnbsp;fromnbsp;crm_yh_238592_viewnbsp;wherenbsp;id=iduser";
		var sql_recent = "select /*main*/zx.id idzx,zx.id,jt.crm_surname 家长姓名,jt.crmzdy_80620120 家长手机,zx.crmzdy_81636452_id idls,isnull(zx.crmzdy_81636452,'') 负责老师,crmzdy_81843299 孩子,convert(varchar(20),zx.look_time,120) 最近浏览时间 from crm_sj_238592_view jt join crm_zdytable_238592_25111_238592_view zx on zx.crmzdy_81620171_id=@idGym and zx.look_time>convert(varchar(10),getdate(),120) and zx.look_time<convert(varchar(10),getdate()add;1,120) and zx.crmzdy_81611091_id=jt.id;"
        var sql_potential ="with zx as(select jt.id idjt,zx.id,zx.id idzx,zx.crmzdy_81636452_id idls,zx.crmzdy_81636452 负责老师,jt.crm_surname 家长姓名,jt.crmzdy_80620120 家长手机,convert(varchar(10),zx.crmzdy_81620163,120) 咨询日期,zx.crmzdy_81620162 获得家长信息的渠道,zx.crmzdy_81636187 客户质量评估,zx.crmzdy_81620171 咨询中心,zx.crmzdy_82025400 最近体验,zx.look_time 最近浏览时间 from crm_sj_238592_view jt join crm_zdytable_238592_25111_238592_view zx on zx.crmzdy_81620171_id = @idGym /*中心*/ @whereLs and zx.crmzdy_81611091_id=jt.id left join crm_zdytable_238592_23796_238592 ht on ht.crmzdy_81620220_id=zx.id and ht.isdelete=0 where ht.crm_name is null) select /*main*/idzx,idls,id,负责老师,家长姓名,家长手机,咨询中心,咨询日期,获得家长信息的渠道,客户质量评估,isnull((select crmzdy_81755581+',' from crm_zdytable_238592_23893_238592_view hz where hz.crmzdy_80653840_id=zx.idJt @whereAge @whereNoIntro order by hz.id desc for xml path('')),'') 孩子,最近体验,最近浏览时间 from zx;"
        var sql_active ="select/*main*/ zx.id,zx.id idzx,zx.crmzdy_81636452_id idls,zx.crmzdy_81636452 负责老师,jt.crm_surname 家长姓名,jt.crmzdy_80620120 家长手机,convert(varchar(20),zx.look_time,120) 最近浏览时间,zx.crmzdy_81620171 咨询中心,zx.crmzdy_81802303 报名课程情况,isnull((select crmzdy_81755581+',' from crm_zdytable_238592_23893_238592_view hz where hz.crmzdy_80653840_id=jt.id @whereAge order by hz.id desc for xml path('')),'') 孩子 from crm_sj_238592_view jt join crm_zdytable_238592_25111_238592_view zx on zx.crmzdy_81620171_id =@idGym/*中心*/  @whereLs and zx.crmzdy_81611091_id=jt.id where exists(select 1 from crm_zdytable_238592_23796_238592_view ht,crm_zdytable_238592_25115_238592_view bmksb where bmksb.crmzdy_81486464_id=ht.id and bmksb.crmzdy_81733119='销售' and ht.crmzdy_81620220_id=zx.id and ht.crmzdy_81762904='课程' and datediff(day,getdate(),ht.crmzdy_81733324)>0 and bmksb.crmzdy_81939586>0);"
        var sql_history ="select/*main*/ zx.id,zx.id idzx,zx.crmzdy_81636452_id idls,zx.crmzdy_81636452 负责老师,jt.crm_surname 家长姓名,jt.crmzdy_80620120 家长手机,convert(varchar(20),zx.look_time,120) 最近浏览时间,zx.crmzdy_81620171 咨询中心,zx.crmzdy_81802303 报名课程情况,isnull((select max(crmzdy_81733324) from crm_zdytable_238592_23796_238592_view ht where ht.crmzdy_81620220_id=zx.id),'') 合同到期日期,isnull((select crmzdy_81755581+',' from crm_zdytable_238592_23893_238592_view hz where hz.crmzdy_80653840_id=jt.id @whereAge order by hz.id desc for xml path('')),'') 孩子 from crm_sj_238592_view jt join crm_zdytable_238592_25111_238592_view zx on zx.crmzdy_81620171_id =@idGym/*中心*/ @whereLs  and zx.crmzdy_81611091_id=jt.id and isnull(zx.crmzdy_81802303,'')<>'' and not exists(select 1 x from crm_zdytable_238592_23796_238592_view ht,crm_zdytable_238592_25115_238592_view bmksb where ht.crmzdy_81620220_id=zx.id and bmksb.crmzdy_81486464_id=ht.id and bmksb.crmzdy_81733119='销售' and ht.crmzdy_81762904='课程' and datediff(day,getdate(),ht.crmzdy_81733324)>0 and bmksb.crmzdy_81939586>0);"
		var sql_ls="select top 1 0 errcode,'ok'errmsg,(select zx.crmzdy_81636452_id id,zx.crmzdy_81636452 name from crm_zdytable_238592_25111_238592_view zx where zx.crmzdy_81620171_id=@idGym group by zx.crmzdy_81636452_id ,zx.crmzdy_81636452 order by name for json auto)formers,(select yh.id,yh.crm_qm name from crm_zdytable_238592_23594_238592_view gym,crm_yh_238592_view yh where gym.id=@idGym and charindex(gym.crm_name,yh.crmzdy_81611236)>0 and yh.crm_yiqiyong=1 and yh.crm_qm<>'测试员工' order by name for json auto)newers,'@sql'sql from crm_yh_238592_view yh for json auto,without_array_wrapper"
       
    </script>

    <style>
	    #result{
		  width:98%!important;
		}
        .ui .checkbox {
            cursor:pointer!important;
            margin-right: 20px!important;
        }
        .dt-input {
            cursor: pointer;
        }
 
    </style>

</head>


<body>
   
     <!--[if lt IE 11]>
     <div class="browser-happy">
         <div class="content">
             <li>浏览器太旧了，为了兼容与美观请更新您的浏览器</p>
             <a href="http://browsehappy.com/">立即更新</a>
         </div>
     </div>
    <![endif]-->
	<div id="app"></div> 
    <script src="family_page.js"></script>
</body>
</html>
